<!DOCTYPE html>
<html>

<head>
  <title></title>
  <meta charset="utf-8" />

  <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=AnOeSZ6a7LgcnBLVjmZ4xfQWIWZjzKv7bDwgyRk-W4NlkGnZGQdk5atUjsunU5yH' async defer></script>
  <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=AnOeSZ6a7LgcnBLVjmZ4xfQWIWZjzKv7bDwgyRk-W4NlkGnZGQdk5atUjsunU5yH' async defer></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/pagina_usuario.css">
</head>
<body>
  <script type='text/javascript'>
    var map;
    var directionsManager;

    function GetMap() {
      map = new Microsoft.Maps.Map('#myMap', {});

      var enderec = '';

      function getText() {
        enderec = document.getElementById("endereco").value;
        return enderec;
      }
      /*
                  Microsoft.Maps.Events.addHandler(directionsManager, 'directionsUpdated', function () {
                          window.setTimeout(function () {
                              directionsManager.clearAll();
                              document.getElementById('printoutPanel').innerHTML = 'Directions cleared (Waypoints cleared, map/itinerary cleared, request and render options reset to default values)';
                          }, 3000);
                      });
      */

      function showPrice() {
        var div = document.getElementById('price');
        div.classList.add('edge--visible');
        div.classList.remove('edge');
      }

      document.getElementById("botao").addEventListener("click", function() {
          navigator.geolocation.getCurrentPosition(function(position) {
          var loc = new Microsoft.Maps.Location(
            position.coords.latitude,
            position.coords.longitude);

          Microsoft.Maps.loadModule('Microsoft.Maps.Directions', function() {
            directionsManager = new Microsoft.Maps.Directions.DirectionsManager(map);

            var seattleWaypoint = new Microsoft.Maps.Directions.Waypoint({
              location: loc
            });
            directionsManager.addWaypoint(seattleWaypoint);

            var workWaypoint = new Microsoft.Maps.Directions.Waypoint({
              address: getText()
            });
            directionsManager.addWaypoint(workWaypoint);

            Microsoft.Maps.Events.addHandler(directionsManager, 'directionsError', directionsError);
            Microsoft.Maps.Events.addHandler(directionsManager, 'directionsUpdated', directionsUpdated);
            Microsoft.Maps.Events.addHandler(directionsManager, 'directionsUpdated', showPrice);

            directionsManager.calculateDirections();
          });
        });
      });
    }

    function directionsUpdated(e) {
      //Get the current route index.
      var routeIdx = directionsManager.getRequestOptions().routeIndex;

      //Get the distance of the route, rounded to 2 decimal places.
      var distance = Math.round(e.routeSummary[routeIdx].distance * 100) / 100;

      //Get the distance units used to calculate the route.
      var units = directionsManager.getRequestOptions().distanceUnit;
      var distanceUnits = '';

      if (units == Microsoft.Maps.Directions.DistanceUnit.km) {
        distanceUnits = 'km'
      } else {
        //Must be in miles
        distanceUnits = 'miles'
      }

      //Time is in seconds, convert to minutes and round off.
      var time = Math.round(e.routeSummary[routeIdx].timeWithTraffic / 60);
      //document.getElementById('routeInfoPanel').innerHTML = 'Distance: ' + distance + ' ' + distanceUnits + '<br/>Time with Traffic: ' + time + ' minutes';
      return distance;
    }

    function directionsError(e) {
      alert('Error: ' + e.message + '\r\nResponse Code: ' + e.responseCode)
    }

    function calculatePrice() {

    }

    var div = document.getElementById("bPrice");
    div.innerHTML = '<h1> 444534 </h1>';
  </script>
  <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=AnOeSZ6a7LgcnBLVjmZ4xfQWIWZjzKv7bDwgyRk-W4NlkGnZGQdk5atUjsunU5yH' async defer></script>

  <div id="principal">
    <div id="menu">
      <input type="checkbox" id="check">
      <label class="icone" for="check"><i class="fa fa-bars" aria-hidden="true"></i></label>
      <div class="barra">
        <div id="entrada">
          &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
          <input name="endereco" required="required" placeholder="&nbsp; &nbsp;Destino" id="endereco" type="text">&nbsp;
          <button type="button" id="botao"  name="button"><p id="calcular">Ir</p></button>
        </div>
        <div id="price" class="edge">
          &nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;
          <div id="bPrice">

          </div>
        </div>
      </div>
    </div>
    <div id="myMap" style="position:fixed;width:100%;height:100%;"></div>
  </div>
  <div id='routeInfoPanel'></div>
</body>
</html>
